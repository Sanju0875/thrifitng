{% extends 'shop/base.html' %}

{% block title %}
  Thrift Store - Checkout
{% endblock %}

{% block content %}
  <div class="container my-5">
    <form method="post">
      {% csrf_token %}

      <div class="row g-4">
        <!-- Billing Form -->
        <div class="col-md-7">
          <div class="card p-4 shadow-sm">
            <h5 class="mb-4">Billing Address</h5>

            {{ form.non_field_errors }}

            <div class="row mb-3">
              <div class="col">{{ form.first_name.label_tag }} {{ form.first_name }}</div>
              <div class="col">{{ form.last_name.label_tag }} {{ form.last_name }}</div>
            </div>

            <div class="row mb-3">
              <div class="col">{{ form.email.label_tag }} {{ form.email }}</div>
              <div class="col">{{ form.phone.label_tag }} {{ form.phone }}</div>
            </div>

            <div class="row mb-3">
              <div class="col">{{ form.address1.label_tag }} {{ form.address1 }}</div>
              <div class="col">{{ form.address2.label_tag }} {{ form.address2 }}</div>
            </div>

            <div class="row mb-3">
              <div class="col">{{ form.city.label_tag }} {{ form.city }}</div>
              <div class="col">{{ form.state.label_tag }} {{ form.state }}</div>
              <div class="col">{{ form.country.label_tag }} {{ form.country }}</div>
            </div>

            <div class="mb-3">{{ form.note.label_tag }} {{ form.note }}</div>
          </div>
        </div>

        <!-- Order Summary -->
        <div class="col-md-5">
          <div class="card p-4 shadow-sm">
            <h5 class="mb-4">Order Summary</h5>

            {% if cart_items %}
              {% for item in cart_items %}
                <div class="d-flex align-items-center mb-3">
                  <img src="{% if item.product.image %}
                      {{ item.product.image.url }}
                    {% else %}
                      https://via.placeholder.com/60x60
                    {% endif %}"
                    alt="{{ item.product.title }}"
                    style="width: 60px; height: 60px; object-fit: cover;"
                    class="me-3 rounded"
                    onerror="this.src='https://via.placeholder.com/60x60'" />
                  <div class="flex-grow-1">
                    <h6 class="mb-0">{{ item.product.title }}</h6>
                    <small>Qty: {{ item.quantity }}</small>
                  </div>
                  <div class="text-end">
                    <strong>${{ item.subtotal }}</strong>
                  </div>
                </div>
              {% endfor %}
              <hr />
              <div class="d-flex justify-content-between mb-3">
                <strong>Total:</strong>
                <strong>${{ total_price }}</strong>
              </div>
            {% else %}
              <p class="text-center text-muted mb-3">No items in cart</p>
              <div class="d-flex justify-content-between mb-3">
                <strong>Total:</strong>
                <strong>$0</strong>
              </div>
            {% endif %}

            <button type="submit" class="btn btn-primary w-100 mt-2">Place Order</button>
            <a href="{% url 'products' %}" class="btn btn-outline-secondary w-100 mt-2">Continue Shopping</a>
          </div>
        </div>
      </div>
    </form>
  </div>
{% endblock %}
